file(GLOB sources ../src/*${cpp_ext})

add_executable(mtfmapper_bin ${sources})
set_target_properties(mtfmapper_bin PROPERTIES CLEAN_DIRECT_OUTPUT 1 OUTPUT_NAME mtf_mapper)
set_target_properties(mtfmapper_bin PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
if (MSVC)
  set_target_properties(mtfmapper_bin PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE ${CMAKE_CURRENT_BINARY_DIR})
endif (MSVC)
target_link_libraries(mtfmapper_bin ${OpenCV_LIBS} ${CMAKE_THREAD_LIBS_INIT})

file(GLOB gen_sources ../src/generator/*${cpp_ext})
add_executable(generate_rectangle ${gen_sources})
set_target_properties(generate_rectangle PROPERTIES CLEAN_DIRECT_OUTPUT 1 OUTPUT_NAME mtf_generate_rectangle)
set_target_properties(generate_rectangle PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
if (MSVC)
  set_target_properties(generate_rectangle PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE ${CMAKE_CURRENT_BINARY_DIR})
endif (MSVC)
target_link_libraries(generate_rectangle ${OpenCV_LIBS} ${CMAKE_THREAD_LIBS_INIT})

file(GLOB chart_sources ../src/test_chart_generator/*${cpp_ext})
add_executable(generate_test_chart ${chart_sources})
set_target_properties(generate_test_chart PROPERTIES CLEAN_DIRECT_OUTPUT 1 OUTPUT_NAME mtf_generate_test_chart)
set_target_properties(generate_test_chart PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
if (MSVC)
  set_target_properties(generate_test_chart PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE ${CMAKE_CURRENT_BINARY_DIR})
endif (MSVC)
target_link_libraries(generate_test_chart ${OpenCV_LIBS} ${CMAKE_THREAD_LIBS_INIT})

# Qt5 
set(CMAKE_AUTOMOC ON)
set(CMAKE_INCLUDE_CURRENT_DIR ON)
find_package(Qt5Widgets)

get_target_property(q5name Qt5::Widgets LOCATION)

IF (EXISTS ${q5name})
  file(GLOB qt_SRCS ${PROJECT_SOURCE_DIR}/src/gui/*${cpp_ext})
  add_executable(mtf_mapper_gui ${qt_SRCS})
  set_target_properties(mtf_mapper_gui PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
  if (MSVC)
    set_target_properties(mtf_mapper_gui PROPERTIES RUNTIME_OUTPUT_DIRECTORY_RELEASE ${CMAKE_CURRENT_BINARY_DIR})
  endif (MSVC)
  qt5_use_modules(mtf_mapper_gui Widgets)
  target_link_libraries(mtf_mapper_gui ${QT_LIBRARIES})
  install(PROGRAMS ${PROJECT_BINARY_DIR}/bin/mtf_mapper_gui DESTINATION bin)
ELSE (EXISTS ${q5name})
  message("QT5Widgets not found, not configuring GUI")
ENDIF (EXISTS ${q5name})

install(TARGETS mtfmapper_bin generate_rectangle generate_test_chart mtf_mapper_gui RUNTIME DESTINATION bin)
